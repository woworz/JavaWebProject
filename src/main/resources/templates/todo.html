<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>TodoList</title>
</head>
<body>
<h2>TodoList</h2>
<form th:action="@{/todo/add}" method="post">
    <div>
        <label for="title">标题：</label>
        <input type="text" id="title" name="title" required>
    </div>
    <div>
        <label for="description">描述：</label>
        <input type="text" id="description" name="description" required>
    </div>
    <div>
        <label for="reminderTime">提醒时间：</label>
        <input type="datetime-local" id="reminderTime" name="reminderTime">
    </div>
    <div>
        <label for="category">分类：</label>
        <select id="category" name="categoryId">
            <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}" th:selected="${category.id == 1}"></option>
        </select>
    </div>
    <div>
        <input type="hidden" name="completed" value="false">
        <button type="submit">添加</button>
    </div>
</form>
<ul>
    <li th:each="todo : ${todos}">
        <form th:action="@{/todo/update}" method="post">
            <input type="hidden" name="id" th:value="${todo.id}">
            <div>
                <label>标题：</label>
                <input type="text" name="title" th:value="${todo.title}" required>
            </div>
            <div>
                <label>描述：</label>
                <input type="text" name="description" th:value="${todo.description}" required>
            </div>
            <div>
                <label>完成：</label>
                <input type="checkbox" name="completed" th:checked="${todo.completed}">
            </div>
            <div>
                <label>提醒时间：</label>
                <input type="datetime-local" name="reminderTime"
                       th:if="${not #lists.isEmpty(todo.reminders)}"
                       th:value="${#dates.format(todo.reminders[0].reminderTime, 'yyyy-MM-dd\'T\'HH:mm')}" />
            </div>
            <div>
                <label>修改分类：</label>
                <select name="categoryId">
                    <option th:each="category : ${categories}" th:value="${category.id}" th:text="${category.name}"
                            th:selected="${todo.category != null ? category.id == todo.category.id : category.id == 1}"></option>
                </select>
            </div>
            <div>
                <input type="hidden" name="completed" th:value="${todo.completed ? 'true' : 'false'}">
                <button type="submit">更新</button>
            </div>
        </form>
        <form th:action="@{/todo/delete}" method="post">
            <input type="hidden" name="id" th:value="${todo.id}">
            <button type="submit">删除</button>
        </form>
    </li>
</ul>
</body>
</html>
